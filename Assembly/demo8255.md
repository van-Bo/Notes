## 实验要求
- 子实验1
  1. 根据 8255 基本输入输出实验接线图连接实验箱电路, 8255B 口接逻辑电平开关 K0-K7, A 口接 LED 显示电路 L0-L7
  2. 编程实现通过开关 K0-K7 控制对应的 LED 灯亮
- 子实验2
  1. 根据 8255 方式1中断输入输出实验接线图连接试验箱电路
  2. 通过 MIR7 中断一次, 输入一次开关值到 LED (MIR7 直接连 KK1-)

## 8255 芯片工作方式
- 方式0
  - 基本输入/输出模式(最简单), 不需要任何握手信号
  - 适用于简单的数据传输, 没有严格的时序要求
  - 数据直接在端口与设备之间传输
- 方式1
  - 提供握手信号, 用于控制数据传输, 确保数据准确性
  - 适用于要求较高的数据传输, 确保数据不会丢失或错误
  - 除了数据线, 还有控制线(握手信号线)用于协调数据传输

## 实验源码
- 子实验1
```asm
;=========================================================
; 文件名: A82551.ASM
; 功能描述: A 口为输出，B 口为输入，将读入的数据输出显示
;           IOY0
;=========================================================

IOY0         EQU   0600H          ;片选 IOY0 对应的端口始地址
MY8255_A     EQU   IOY0+00H*2     ;8255 的 A 口地址
MY8255_B     EQU   IOY0+01H*2     ;8255 的 B 口地址
MY8255_C     EQU   IOY0+02H*2     ;8255 的 C 口地址
MY8255_MODE  EQU   IOY0+03H*2     ;8255 的控制寄存器地址

SSTACK	SEGMENT STACK
		DW 32 DUP(?)
SSTACK	ENDS
CODE	SEGMENT
		ASSUME CS:CODE
START:	MOV DX, MY8255_MODE
		MOV AL, 82H
		OUT DX, AL
AA1:	MOV DX, MY8255_B
		IN  AL, DX
		CALL DELAY
		MOV DX, MY8255_A
		OUT DX, AL
		JMP AA1
DELAY:	PUSH CX
		MOV CX, 0F00H
AA2:	PUSH AX
		POP  AX
		LOOP AA2
		POP  CX
		RET
CODE	ENDS
END  START
```

- 子实验2
```asm
;=========================================================
; 文件名: A82553.ASM
; 功能描述: 本实验使 8255 端口 A 工作在方式 0 并作为输出口，
;           端口 B 工作在方式 1 并作为输入口, 并处理外部中断
;=========================================================

IOY0         EQU   0600H          ;片选 IOY0 对应的端口始地址
MY8255_A     EQU   IOY0+00H*2     ;8255 的 A 口地址
MY8255_B     EQU   IOY0+01H*2     ;8255 的 B 口地址
MY8255_C     EQU   IOY0+02H*2     ;8255 的C口地址
MY8255_MODE  EQU   IOY0+03H*2     ;8255 的控制寄存器地址

STACK1 	SEGMENT STACK
        DW 256 DUP(?)
STACK1 	ENDS
CODE 	SEGMENT
        ASSUME CS:CODE
START: 	MOV DX,MY8255_MODE         ;初始化 8255 工作方式
       	MOV AL,86H                 ;A 口为工作方式 0 (输出)，B 口为工作方式 1 (输入)
       	OUT DX,AL
       	MOV DX,MY8255_MODE         ;C 口 PC2 置位
       	MOV AL,05H                 
       	OUT DX,AL

		;中断向量表的设置
		PUSH DS
		MOV AX, 0000H
		MOV DS, AX
		MOV AX, OFFSET MIR7			;取中断入口地址
		MOV SI, 003CH				;中断矢量地址
		MOV [SI], AX				;填 IRQ7 的偏移矢量
		MOV AX, CS					;段地址
		MOV SI, 003EH
		MOV [SI], AX				;填 IRQ7 的段地址矢量
		CLI
		POP DS

		;初始化主片 8259
		MOV AL, 11H
		OUT 20H, AL				;ICW1
		MOV AL, 08H
		OUT 21H, AL				;ICW2
		MOV AL, 04H
		OUT 21H, AL				;ICW3
		MOV AL, 01H
		OUT 21H, AL				;ICW4
		MOV AL, 6FH				;OCW1
		OUT 21H, AL
		STI       
AA1:	NOP
		JMP AA1
MIR7:  	PUSH AX
       	MOV DX,MY8255_B            ;读 B 口
       	IN  AL,DX
		CALL DELAY 				   ;调用延时程序
       	MOV DX,MY8255_A            ;写 A 口
       	OUT DX,AL
	   	MOV AL,20H
       	OUT 20H,AL       
       	POP AX  
       	IRET  
DELAY:	PUSH CX
		MOV CX, 0F00H
AA0:	PUSH AX
		POP  AX
		LOOP AA0
		POP CX
		RET
CODE 	ENDS
END START
```

## 子实验1 要点分析

### 控制字设置
- START 为程序入口标签
- 设置 A 口为输出, B 口为输入, 且二者的工作方式均为方式 0
```asm
START:	
	MOV DX, MY8255_MODE
	MOV AL, 82H
	OUT DX, AL
```

### 主循环
- AA1 为主循环标签
- 层次逻辑: 读取 B 口数据, 经过一定延时, 将数据 输出到 A 口
- `JMP AA1` 跳转回 AA1, 形成一个无限循环, 持续读取 B 口数据并输出到 A 口
```asm
AA1:	
	MOV DX, MY8255_B
	IN  AL, DX
	CALL DELAY
	MOV DX, MY8255_A
	OUT DX, AL
	JMP AA1
```

### 延时子程序
- DELAY 为延时子程序的标签
- `CX` 存储延时计数值 `00F0H`, 程序前后需要针对 `CX` 有压、弹栈的操作, 以保护现场
- AA2 为延时循环开始的标签
```asm
DELAY:	
	PUSH CX
	MOV CX, 0F00H
AA2:	
	PUSH AX
	POP  AX
	LOOP AA2
	POP  CX
	RET
```

## 子实验2 要点分析

### 程序入口
- 在方式 1 中, C 口的某些位用于握手信号:
  - PC4（STB#）：数据选通信号（Strobe）。当数据有效时，该线被拉低，通知接收设备数据已准备好。
  - PC2（INTR）：中断请求信号。当数据被成功接收时，B 口通过 PC2 发出中断请求。
  - PC1（IBF#）：输入缓冲区满信号（Input Buffer Full）。当数据被成功接收时，该线被拉高，通知发送设备输入缓冲区已满。
  - PC0（ACK#）：确认信号（Acknowledge）。接收设备通过该线通知发送设备数据已经被成功接收。
- 根据实验接线图的握手信号分析:
  - PC2 接受中断信号: 用于接受外部设备或传感器的中断信号(例如, KK1-), 通知 8255 有新数据需要处理
  - PC0 提交中断信号: 用于将中断信号提交给系统总线中的 MIR7, 从而触发系统的中断处理程序
- 为啥没有显示的 PC0 的置位操作:
  - 通过 8255 芯片的硬件逻辑和电路设计，控制信号的管理是自动进行的。PC0 作为确认信号，会在硬件逻辑中根据传输状态自动处理。
```asm
START:  
    MOV DX,MY8255_MODE         ; 初始化 8255 工作方式
    MOV AL,86H                 ; A 口为工作方式 0 (输出)，B 口为工作方式 1 (输入)
    OUT DX,AL
    MOV DX,MY8255_MODE         ; C 口 PC2 置位
    MOV AL,05H                 
    OUT DX,AL
```
